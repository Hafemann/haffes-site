<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title id="pageTitle">Card√°pio Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background: #15101c; color: #fff; font-family: sans-serif; margin: 0; }
    header { padding: 18px 30px; background: #222; display: flex; align-items: center; justify-content: space-between; }
    .logo-section { display: flex; align-items: center; gap: 12px; }
    .logo-img { width: 48px; height: 48px; background: #ff6600; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2em; overflow: hidden; }
    .logo-img img { width: 100%; height: 100%; object-fit: cover; }
    .main { max-width: 1000px; margin: 30px auto; display: flex; flex-wrap: wrap; gap: 30px; }
    .card { background: #230f33; border-radius: 12px; padding: 20px; flex: 1 1 200px; min-width: 260px; }
    button, input, textarea, select { font-family: inherit; }
    .btn { background: #ff6600; color: #1a1a1a; border: none; padding: 8px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; margin: 8px 0 0 0;}
    .admin-only { display: none; }
    .show { display: block !important; }
    .prod-img { width: 100%; height: 140px; background: #ff6600; object-fit: cover; border-radius: 6px;}
    label { display: block; font-weight: bold; margin: 10px 0 2px 0; }
    .small { font-size: .9em; color: #bbb; }
    .menu-title { color: #ff6600; font-size: 1.6em; font-weight: 700; margin-bottom: 18px; }
    .adicional { font-size: .97em; background: #242426; padding: 5px 10px; border-radius: 4px; margin: 2px 0;}
    .edit-fields input, .edit-fields textarea { width: 100%; }
  </style>
</head>
<body>
<header>
  <div class="logo-section">
    <div class="logo-img" id="logoHeader"></div>
    <div>
      <h1 style="font-size:1.3em;" id="siteTitle"></h1>
      <p style="color:#ffe4cc; margin:0; font-size:.95em;" id="siteSubtitle"></p>
    </div>
  </div>
  <div>
    <button class="btn" id="loginBtn" onclick="showLogin()">Admin</button>
    <button class="btn admin-only" id="configBtn" onclick="showConfig()">‚öôÔ∏è Configura√ß√µes</button>
    <button class="btn admin-only" id="logoutBtn" onclick="logout()" style="display:none">Sair</button>
  </div>
</header>
<div class="main" id="mainMenu">
  <div style="width:100%">Carregando card√°pio...</div>
</div>

<!-- Configura√ß√£o geral -->
<div class="main admin-only" id="configPanel" style="display:none; flex-direction:column; gap:20px;">
  <h2>Configura√ß√µes Gerais</h2>
  <label>Nome do site</label>
  <input id="inpTitulo" placeholder="Ex: Haffe's Hamburgueria">
  <label>Subt√≠tulo</label>
  <input id="inpSubtitulo" placeholder="Ex: Card√°pio Online">
  <label>Logo - Link da imagem PNG/JPG (Drive ou Imgur p√∫blico)</label>
  <input id="inpLogoUrl" placeholder="Cole aqui o link da imagem">
  <label>Cor Prim√°ria</label>
  <input id="inpCor" type="color" value="#ff6600">
  <label>Taxa de Entrega (R$)</label>
  <input id="inpEntrega" type="number" step="0.01" min="0" value="5">
  <button class="btn" onclick="salvarConfig()">Salvar Configura√ß√µes</button>
  <button class="btn" style="background:#444;" onclick="hideConfig()">Voltar</button>
  <div id="salvarMsg" class="small"></div>
</div>

<!-- Login admin -->
<div id="loginPanel" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(20,20,20,.92);z-index:999;align-items:center;justify-content:center">
  <div style="padding:40px; max-width:300px; background:#130f20; border-radius:14px;">
    <h2 style="text-align:center; color: #ff6600;">Entrar como admin</h2>
    <input id="loginPass" type="password" placeholder="Senha" style="width:100%;padding:10px;margin:18px 0;">
    <button class="btn" style="width:100%;" onclick="doLogin()">Entrar</button>
    <div class="small" id="loginError" style="color:#ff4444;"></div>
    <button style="background:none;border:none;color:#fff;margin-top:8px;" onclick="hideLogin()">Voltar</button>
  </div>
</div>

<script>
// --------- CONFIG ---------
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwuR1ycdChaM-lHbhKf1FW5zkHGrsYNy0HoSGb-t4gYxDp2lhUVuxn2poUQ8tZok1tAvg/exec';
const ADMIN_PASS = '1234'; // Altere!!

let config = {};
let produtos = [];
let admin = false;

// --------- LOAD -----------
window.onload = async function() {
  await carregarConfig();
  await carregarProdutos();
  renderCabe√ßalho();
  renderMenu();
};

// --------- CONFIG FUNC ---------
async function carregarConfig() {
  let r = await fetch(APPS_SCRIPT_URL+'?action=getConfig');
  config = await r.json();
  document.getElementById("siteTitle").innerText = config.nome || "Nome do Site";
  document.getElementById("siteSubtitle").innerText = config.subtitulo || "";
  document.getElementById("logoHeader").innerHTML = config.logo_url ? `<img src="${config.logo_url}">` : "üçî";
  document.getElementById("inpTitulo").value = config.nome || "";
  document.getElementById("inpSubtitulo").value = config.subtitulo || "";
  document.getElementById("inpLogoUrl").value = config.logo_url || "";
  document.getElementById("inpCor").value = config.cor || "#ff6600";
  document.getElementById("inpEntrega").value = config.entrega || 5;
  document.documentElement.style.setProperty('--primary', config.cor || '#ff6600');
}

function renderCabe√ßalho() {
  document.getElementById("siteTitle").innerText = config.nome || "Nome do Site";
  document.getElementById("siteSubtitle").innerText = config.subtitulo || "";
  document.getElementById("logoHeader").innerHTML = config.logo_url ? `<img src="${config.logo_url}">` : "üçî";
  document.documentElement.style.setProperty('--primary', config.cor || '#ff6600');
}

function showConfig() {
  document.getElementById("mainMenu").style.display = "none"; 
  document.getElementById("configPanel").style.display = "flex";
}
function hideConfig() {
  document.getElementById("configPanel").style.display = "none";
  document.getElementById("mainMenu").style.display = "flex";
}
async function salvarConfig() {
  document.getElementById("salvarMsg").innerText = "Salvando...";
  await fetch(APPS_SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      action:"salvarConfig",
      chave:"nome", valor: document.getElementById("inpTitulo").value
    })
  });
  await fetch(APPS_SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      action:"salvarConfig",
      chave:"subtitulo", valor: document.getElementById("inpSubtitulo").value
    })
  });
  await fetch(APPS_SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      action:"salvarConfig",
      chave:"logo_url", valor: document.getElementById("inpLogoUrl").value
    })
  });
  await fetch(APPS_SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      action:"salvarConfig",
      chave:"cor", valor: document.getElementById("inpCor").value
    })
  });
  await fetch(APPS_SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      action:"salvarConfig",
      chave:"entrega", valor: document.getElementById("inpEntrega").value
    })
  });
  await carregarConfig();
  renderCabe√ßalho();
  document.getElementById("salvarMsg").innerText = "Salvo!";
  setTimeout(()=>{ document.getElementById("salvarMsg").innerText = ""; },1800);
}

// --------- PRODUTOS ---------
async function carregarProdutos() {
  try {
    let r = await fetch(APPS_SCRIPT_URL+'?action=getProdutos');
    produtos = await r.json();
    if (!Array.isArray(produtos)) throw "Formato inesperado";
    if(produtos.length === 0) {
      document.getElementById("mainMenu").innerHTML = "<div>Nenhum produto cadastrado!</div>";
      return;
    }
  } catch(e) {
    document.getElementById("mainMenu").innerHTML = "<div style='color:#ff5050'>Erro ao carregar produtos! Cheque a aba Produtos (<b>cabe√ßalho & dados</b>) e seu Apps Script.</div><pre style='font-size:.9em;color:#aaa'>" + e + "</pre>";
    produtos = [];
    return;
  }
}


// --------- EDITOR DE PRODUTO (EXEMPLO SIMPLES) ---------
window.showEditor = function(id) {
  let prod = produtos.find(p=>p.id==id);
  if(!prod) return;
  let adicionais = (prod.adicionais||[]).map((a,i)=>`<div style="display:flex;gap:8px;">
    <input value="${a.nome}" id="aduNome${i}" placeholder="Adicional" style="flex:2;">
    <input value="${a.preco}" id="aduPreco${i}" type="number" step="0.01" style="width:70px;">
  </div>`).join('');
  document.body.insertAdjacentHTML('beforeend', `<div id="editorModal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000c;display:flex;align-items:center;justify-content:center;z-index:999;">
    <div style="background:#23283e;padding:35px 22px;border-radius:14px;max-width:400px;width:90%">
      <h2 style="color:#ff6600;">Editar Produto</h2>
      <div class="edit-fields">
        <label>Nome</label>
        <input id="editNome" value="${prod.nome}">
        <label>Descri√ß√£o</label>
        <textarea id="editDesc">${prod.descricao}</textarea>
        <label>Pre√ßo</label>
        <input id="editPreco" type="number" step="0.01" value="${prod.preco}">
        <label>Categoria</label>
        <input id="editCat" value="${prod.categoria||''}">
        <label>Foto (url)</label>
        <input id="editFoto" value="${prod.foto_url||''}">
        <label>Adicionais</label>
        <div id="adiconteudo">${adicionais||''}</div>
        <button class="btn" onclick="adAdicionar()">Adicionar adicional</button>
      </div>
      <button class="btn" onclick="salvarProduto('${prod.id}')">Salvar</button>
      <button class="btn" style="background:#444;" onclick="document.getElementById('editorModal').remove()">Cancelar</button>
      <div id="salvarMsg" style="margin-top:8px;font-size: .95em"></div>
    </div></div>`);
};
window.adAdicionar = function() {
  let cnt = document.getElementById('adiconteudo');
  let i = cnt.children.length;
  cnt.insertAdjacentHTML('beforeend', 
    `<div style="display:flex;gap:8px;">
      <input placeholder="Adicional" id="aduNome${i}" style="flex:2;">
      <input type="number" step="0.01" id="aduPreco${i}" style="width:70px;">
    </div>`);
};
window.salvarProduto = async function(id) {
  let adic = [];
  let i=0; while (document.getElementById('aduNome'+i)) {
    let nome = document.getElementById('aduNome'+i).value;
    let preco = parseFloat(document.getElementById('aduPreco'+i).value) || 0;
    if (nome) adic.push({nome:nome, preco:preco});
    i++;
  }
  let prod = {
    id: id,
    nome: document.getElementById('editNome').value.trim(),
    descricao: document.getElementById('editDesc').value.trim(),
    preco: document.getElementById('editPreco').value,
    categoria: document.getElementById('editCat').value,
    foto_url: document.getElementById('editFoto').value,
    adicionais: adic
  };
  document.getElementById("salvarMsg").innerText = "Salvando...";
  await fetch(APPS_SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      action: "editarProduto",
      produto: prod
    })
  });
  document.getElementById("salvarMsg").innerText = "Salvo!";
  setTimeout(()=>{ document.getElementById('editorModal').remove(); location.reload(); },800);
};

// --------- LOGIN/LOGOUT ---------
function showLogin() { document.getElementById("loginPanel").style.display="flex"; }
function hideLogin() { document.getElementById("loginPanel").style.display="none"; }
function doLogin() {
  if (document.getElementById("loginPass").value == ADMIN_PASS) {
    admin = true;
    document.querySelectorAll(".admin-only").forEach(e=>e.classList.add("show"));
    document.getElementById("loginPanel").style.display = "none";
    document.getElementById("loginBtn").style.display = "none";
    document.getElementById("logoutBtn").style.display = "inline-block";
    document.getElementById("configBtn").style.display = "inline-block";
    renderMenu();
  } else {
    document.getElementById("loginError").innerText="Senha errada";
  }
}
function logout() {
  admin = false;
  document.querySelectorAll(".admin-only").forEach(e=>e.classList.remove("show"));
  document.getElementById("loginBtn").style.display="inline-block";
  document.getElementById("logoutBtn").style.display="none";
  document.getElementById("configBtn").style.display="none";
  renderMenu();
}
</script>
</body>
</html>

